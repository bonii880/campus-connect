<!DOCTYPE html>
<html>
<head>
    <title>Student Profile</title>
</head>
<body>

<h2>Create Your Student Profile</h2>

<input type="file" id="profileImage" accept="image/*"><br><br>
<img id="preview" width="150" style="border-radius: 10px;"><br><br>

<input type="text" id="name" placeholder="Name"><br><br>
<input type="text" id="nickname" placeholder="Nickname"><br><br>
<input type="number" id="age" placeholder="Age"><br><br>
<input type="text" id="county" placeholder="County"><br><br>
<input type="text" id="year" placeholder="Year of Study"><br><br>
<input type="text" id="school" placeholder="University / College"><br><br>

<button id="saveProfile">Save Profile</button>

<script type="module">

// ------------------------ CLOUDINARY UPLOAD FUNCTION ------------------------
async function uploadImageToCloudinary(file) {
  const cloudName = "YOUR_CLOUD_NAME";
  const uploadPreset = "YOUR_UPLOAD_PRESET";

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", uploadPreset);

  const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  return data.secure_url;
}

// ------------------------ IMAGE UPLOAD + PREVIEW ------------------------
const fileInput = document.getElementById("profileImage");
const preview = document.getElementById("preview");
let uploadedImageURL = "";

fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  preview.src = URL.createObjectURL(file);
  uploadedImageURL = await uploadImageToCloudinary(file);
});

// ------------------------ FIREBASE (ONLY FOR SAVING TEXT + IMAGE URL) ------------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  // YOUR FIREBASE INFO
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ------------------------ SAVE PROFILE ------------------------
document.getElementById("saveProfile").addEventListener("click", async () => {

  if (uploadedImageURL === "") {
      alert("Please upload an image first!");
      return;
  }

  const userId = localStorage.getItem("userId");

  await setDoc(doc(db, "users", userId), {
    type: "student",
    name: document.getElementById("name").value,
    nickname: document.getElementById("nickname").value,
    age: document.getElementById("age").value,
    county: document.getElementById("county").value,
    year: document.getElementById("year").value,
    school: document.getElementById("school").value,
    profileImage: uploadedImageURL
  });

  window.location.href = "home.html";
});

</script>

</body>
</html>
