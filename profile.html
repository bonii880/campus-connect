<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CampusConnect ‚Äî Complete Profile</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap');

    :root{
      --pink-1:#ffb6c1;
      --pink-2:#ff69b4;
      --accent:#ff1493;
      --card-bg: rgba(255,255,255,0.95);
      --muted:#6b6b6b;
    }

    html,body{height:100%;margin:0;}
    body{
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--pink-1), var(--pink-2));
      -webkit-font-smoothing:antialiased;
      overflow-y:auto;
      padding:40px 20px;
      display:flex;
      justify-content:center;
    }

    .page {
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:start;
    }

    /* left: big card for info and buttons */
    .left {
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .hero {
      background: radial-gradient(circle at 10% 10%, rgba(255,255,255,0.6), rgba(255,255,255,0.3));
      padding:28px;
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
      color:#222;
    }
    .hero h1{
      margin:0;
      font-family:'Great Vibes', cursive;
      color:var(--accent);
      font-size:44px;
      line-height:1;
    }
    .hero p{ margin:10px 0 0; color:var(--muted); }

    .choice-row{
      display:flex;
      gap:16px;
      margin-top:18px;
    }
    .big-btn{
      flex:1;
      padding:18px 14px;
      border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.78));
      border: 1px solid rgba(255,255,255,0.6);
      cursor:pointer;
      text-align:center;
      font-weight:600;
      color:#222;
      box-shadow: 0 8px 20px rgba(255,105,180,0.12);
      transition:transform .14s ease, box-shadow .14s ease;
    }
    .big-btn:hover{ transform:translateY(-4px); box-shadow:0 16px 40px rgba(255,105,180,0.18); }
    .big-btn.active{ background:linear-gradient(90deg,var(--accent),var(--pink-2)); color:white; }

    /* right: form card */
    .card {
      background: var(--card-bg);
      padding:22px;
      border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,0.12);
    }
    .card h2{ margin-top:0; color:var(--accent); font-family:'Great Vibes', cursive; font-size:30px; }
    .muted{ color:var(--muted); font-size:14px; margin-top:6px; }

    .form-row{ display:flex; gap:12px; }
    .field{ margin:12px 0; }
    input[type="text"], input[type="number"], select, textarea {
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,105,180,0.35);
      font-size:15px;
      box-sizing:border-box;
    }
    textarea{ resize: vertical; min-height:84px; }

    label.file-label{
      display:block;
      padding:10px;
      border:2px dashed rgba(255,105,180,0.25);
      border-radius:10px;
      text-align:center;
      cursor:pointer;
      color:#333;
      background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.6));
    }
    .small-note{ font-size:13px; color:var(--muted); margin-top:6px; }

    .save-btn{
      width:100%;
      padding:12px;
      border-radius:30px;
      background: linear-gradient(90deg,var(--accent),var(--pink-2));
      color:white;
      border:none;
      font-weight:700;
      font-size:16px;
      cursor:pointer;
      box-shadow:0 10px 30px rgba(255,20,147,0.12);
    }
    .save-btn:hover{ transform:translateY(-3px); }

    .success{ color:green; font-weight:600; margin-top:8px; }
    .error{ color:#a00; font-weight:600; margin-top:8px; }

    /* responsive: single column on small screens */
    @media (max-width:980px){
      .page{ grid-template-columns:1fr; padding-bottom:80px; }
      .left{ order:2; }
    }

  </style>
</head>
<body>
  <div class="page">
    <!-- LEFT: intro & selection -->
    <div class="left">
      <div class="hero">
        <h1>CampusConnect</h1>
        <p>Create your matchmaking profile ‚Äî choose Student or Outsider to begin. Use real photos, be honest, and find meaningful (or spicy) connections.</p>

        <div class="choice-row" style="margin-top:18px;">
          <div id="btn-student" class="big-btn active" onclick="selectType('student')">
            üéì I'm a Student
          </div>
          <div id="btn-outsider" class="big-btn" onclick="selectType('outsider')">
            üåç I'm an Outsider
          </div>
        </div>

        <p class="small-note" style="margin-top:14px;">Students can choose preferences like <strong>Mumama</strong> / <strong>Mubaba</strong>. Outsiders can declare if they are Mumama / Mubaba and choose to look for Sugar Boy / Sugar Girl or other relationship styles.</p>
      </div>

      <div class="card" style="margin-top:18px;">
        <h2>How it works</h2>
        <p class="muted">After saving, your profile will be stored securely. Photos go to Storage; profile details go to Firestore. Later the matchmaking engine will use these fields to find matches across Students and Outsiders.</p>
        <ul class="muted" style="padding-left:18px;">
          <li>Upload <strong>two</strong> photos (recommended)</li>
          <li>Pick clear preferences for better matches</li>
          <li>You can later edit your profile from the dashboard</li>
        </ul>
      </div>
    </div>

    <!-- RIGHT: form -->
    <div class="card" id="formCard">
      <h2 id="formTitle">Student Profile</h2>
      <div class="muted">Fill details below ‚Äî fields marked required should be filled for better matches.</div>

      <!-- shared fields -->
      <div class="field">
        <label class="small-note">Full name *</label>
        <input id="name" type="text" placeholder="Your full name" required />
      </div>

      <div class="form-row">
        <div style="flex:1;" class="field">
          <label class="small-note">Your age *</label>
          <input id="age" type="number" min="16" placeholder="e.g., 22" />
        </div>
        <div style="flex:1;" class="field">
          <label class="small-note">Preferred partner age range</label>
          <input id="preferredAge" type="text" placeholder="e.g., 20-26" />
        </div>
      </div>

      <div class="field">
        <label class="small-note">Hobbies / Interests</label>
        <textarea id="hobbies" placeholder="e.g., music, coding, parties"></textarea>
      </div>

      <!-- photo uploads -->
      <div class="form-row">
        <div style="flex:1;">
          <label class="file-label">Photo 1 (click to choose)
            <input id="photo1" type="file" accept="image/*" style="display:none" />
          </label>
        </div>
        <div style="flex:1;">
          <label class="file-label">Photo 2 (click to choose)
            <input id="photo2" type="file" accept="image/*" style="display:none" />
          </label>
        </div>
      </div>
      <div id="photoNote" class="small-note">Photos are optional but recommended ‚Äî they are stored in Firebase Storage.</div>

      <!-- STUDENT section -->
      <div id="studentSection" style="margin-top:12px;">
        <div class="field">
          <label class="small-note">University / College</label>
          <input id="university" type="text" placeholder="Your institution (if any)" />
        </div>
        <div class="field">
          <label class="small-note">Course / Program</label>
          <input id="course" type="text" placeholder="e.g., Computer Science" />
        </div>

        <div class="field">
          <label class="small-note">Preferences (choose best fit)</label>
          <select id="studentPreference">
            <option value="">-- Choose preference --</option>
            <option value="relationship">Relationship</option>
            <option value="friendship">Friendship</option>
            <option value="one_night">One-night stand</option>
            <option value="fwb">Friends with benefits</option>
            <option value="mumama">Mumama (older woman)</option>
            <option value="mubaba">Mubaba (older man)</option>
          </select>
        </div>
      </div>

      <!-- OUTSIDER section (hidden by default) -->
      <div id="outsiderSection" style="display:none; margin-top:12px;">
        <div class="field">
          <label class="small-note">Occupation</label>
          <input id="occupation" type="text" placeholder="e.g., Engineer, Business Owner" />
        </div>
        <div class="field">
          <label class="small-note">City / Location</label>
          <input id="city" type="text" placeholder="e.g., Nairobi" />
        </div>

        <div class="field">
          <label class="small-note">I am (choose)</label>
          <select id="outsiderIdentity">
            <option value="">-- I am --</option>
            <option value="mubaba">Mubaba (older man)</option>
            <option value="mumama">Mumama (older woman)</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="field">
          <label class="small-note">Looking for</label>
          <select id="outsiderLooking">
            <option value="">-- Looking for --</option>
            <option value="relationship">Relationship</option>
            <option value="friendship">Friendship</option>
            <option value="one_night">One-night stand</option>
            <option value="fwb">Friends with benefits</option>
            <option value="sugar_boy">Sugar Boy</option>
            <option value="sugar_girl">Sugar Girl</option>
          </select>
        </div>
      </div>

      <div style="margin-top:18px;">
        <button class="save-btn" onclick="saveProfile()">Save Profile & Continue</button>
        <div id="statusMsg"></div>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

    // ===== your firebase config (already provided) =====
    const firebaseConfig = {
      apiKey: "AIzaSyARcZM2zSy4Xw5Q7Fn_XNX9zDh2LMAQvqw",
      authDomain: "campusconnect-44ec3.firebaseapp.com",
      projectId: "campusconnect-44ec3",
      storageBucket: "campusconnect-44ec3.appspot.com",
      messagingSenderId: "440410311105",
      appId: "1:440410311105:web:0bb84ca67f0407235d4740",
      measurementId: "G-JZ8R9VS9QC"
    };

    // initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // UI elements
    const btnStudent = document.getElementById('btn-student');
    const btnOutsider = document.getElementById('btn-outsider');
    const formTitle = document.getElementById('formTitle');
    const studentSection = document.getElementById('studentSection');
    const outsiderSection = document.getElementById('outsiderSection');
    const statusMsg = document.getElementById('statusMsg');

    // default type
    let chosenType = 'student';
    function selectType(type){
      chosenType = type;
      if(type === 'student'){
        btnStudent.classList.add('active');
        btnOutsider.classList.remove('active');
        studentSection.style.display = '';
        outsiderSection.style.display = 'none';
        formTitle.textContent = 'Student Profile';
      } else {
        btnOutsider.classList.add('active');
        btnStudent.classList.remove('active');
        studentSection.style.display = 'none';
        outsiderSection.style.display = '';
        formTitle.textContent = 'Outsider Profile';
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // wired file-label clicks
    document.querySelectorAll('label.file-label').forEach(label=>{
      label.addEventListener('click', ()=>{ 
        const input = label.querySelector('input[type=file]');
        if(input) input.click();
      });
    });

    // ensure user logged in
    let currentUser = null;
    onAuthStateChanged(auth, user => {
      if(!user){
        alert('Please log in first.');
        window.location.href = 'login.html';
      } else {
        currentUser = user;
      }
    });

    // helper: upload file and return URL
    async function uploadFile(uid, file, slot){
      if(!file) return '';
      const ext = file.name.split('.').pop().toLowerCase();
      const path = `profiles/${uid}/photo_${slot}.${ext}`;
      const storageRef = ref(storage, path);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      return url;
    }

    // save profile
    async function saveProfile(){
      statusMsg.textContent = '';
      statusMsg.className = '';

      if(!currentUser) {
        alert('You must be logged in to save a profile.');
        window.location.href = 'login.html';
        return;
      }

      // basic fields
      const name = document.getElementById('name').value.trim();
      const age = document.getElementById('age').value.trim();
      const preferredAge = document.getElementById('preferredAge').value.trim();
      const hobbies = document.getElementById('hobbies').value.trim();

      if(!name){
        statusMsg.textContent = 'Please enter your name.';
        statusMsg.className = 'error';
        return;
      }

      try {
        statusMsg.textContent = 'Saving profile...';
        statusMsg.className = '';

        // upload photos (if any)
        const file1 = document.getElementById('photo1').files[0];
        const file2 = document.getElementById('photo2').files[0];
        const photo1URL = await uploadFile(currentUser.uid, file1, 1);
        const photo2URL = await uploadFile(currentUser.uid, file2, 2);

        const baseData = {
          uid: currentUser.uid,
          email: currentUser.email || '',
          name,
          age: age || '',
          preferredAge: preferredAge || '',
          hobbies: hobbies || '',
          photos: [photo1URL, photo2URL].filter(Boolean),
          userType: chosenType,
          updatedAt: serverTimestamp()
        };

        if(chosenType === 'student'){
          const university = document.getElementById('university').value.trim();
          const course = document.getElementById('course').value.trim();
          const preference = document.getElementById('studentPreference').value || '';

          const docData = {
            ...baseData,
            university,
            course,
            preference
          };

          await setDoc(doc(db, 'students', currentUser.uid), docData);
        } else {
          const occupation = document.getElementById('occupation').value.trim();
          const city = document.getElementById('city').value.trim();
          const identity = document.getElementById('outsiderIdentity').value || '';
          const looking = document.getElementById('outsiderLooking').value || '';

          const docData = {
            ...baseData,
            occupation,
            city,
            identity,
            looking
          };

          await setDoc(doc(db, 'outsiders', currentUser.uid), docData);
        }

        statusMsg.textContent = 'Profile saved ‚úÖ';
        statusMsg.className = 'success';

        // redirect to home or matchmaking (you can change)
        setTimeout(()=> window.location.href = 'home.html', 900);

      } catch (err) {
        console.error('Save error', err);
        statusMsg.textContent = 'Error saving profile: ' + (err.message || err);
        statusMsg.className = 'error';
      }
    }

    // expose to global for onclick
    window.saveProfile = saveProfile;
    window.selectType = selectType;

    // initialize default UI state
    selectType('student');
  </script>
</body>
</html>
