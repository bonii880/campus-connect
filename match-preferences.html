<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { firebaseConfig } from "./firebase.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  document.getElementById("prefForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const matchType = document.getElementById("matchType").value;
    const campus = document.getElementById("preferredCampus").value;
    const ageRange = document.getElementById("preferredAge").value;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        try {
          await setDoc(doc(db, "preferences", user.uid), {
            matchType,
            campus,
            ageRange,
          });
          alert("Preferences saved! Redirecting to matchmaking...");
          window.location.href = "matchmaking.html";
        } catch (err) {
          console.error("Error saving preferences:", err);
          alert("Failed to save preferences.");
        }
      } else {
        alert("Please log in first.");
        window.location.href = "login.html";
      }
    });
  });
</script>
