<script>
async function saveProfile() {
    const user = auth.currentUser;
    console.log("USER:", user);

    if (!user) {
        alert("You must be logged in!");
        return;
    }

    const fullName = document.getElementById("fullName").value.trim();
    const course = document.getElementById("course").value.trim();
    const year = document.getElementById("year").value.trim();
    const school = document.getElementById("school").value.trim();
    const file = document.getElementById("profileImage").files[0];

    console.log("FORM DATA:", fullName, course, year, school, file);

    if (!fullName || !course || !year || !school || !file) {
        alert("Fill all fields and choose an image!");
        return;
    }

    try {
        console.log("UPLOADING IMAGE...");
        const imageUrl = await uploadToCloudinary(file);
        console.log("IMAGE URL:", imageUrl);

        console.log("SAVING TO FIRESTORE...");
        await db.collection("students").doc(user.uid).set({
            fullName,
            course,
            year,
            school,
            imageUrl,
            uid: user.uid
        });

        alert("Saved successfully!");
        window.location.href = "home.html";

    } catch (error) {
        console.error("ERROR:", error);
        alert("Error saving profile.");
    }
}
</script>
