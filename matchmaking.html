<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CampusConnect Matchmaking üíò</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #ff758c, #ff7eb3);
    color: white;
    min-height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px;
  }

  h1 {
    color: #fff;
    text-shadow: 1px 1px 10px rgba(0,0,0,0.3);
  }

  .match-card {
    background: rgba(0,0,0,0.5);
    border-radius: 15px;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    margin-top: 20px;
    text-align: center;
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }

  img {
    border-radius: 15px;
    width: 100%;
    max-height: 300px;
    object-fit: cover;
  }

  .btn {
    background: #ff4081;
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    color: white;
    cursor: pointer;
    font-size: 1em;
    margin-top: 15px;
    transition: 0.3s;
  }

  .btn:hover { background: #ff1e63; }

  #noMatch {
    margin-top: 40px;
    font-size: 1.2em;
    color: #ffeaea;
  }
</style>
</head>
<body>

<h1>üíû Find Your Match</h1>
<p>Matching based on your preferences...</p>

<div id="matchContainer"></div>
<p id="noMatch" style="display:none;">No perfect match found yet üòî</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Example: current user (you can dynamically load the signed-in user later)
const currentUserName = localStorage.getItem("currentUser") || "Anonymous";

async function findMatch() {
  const querySnapshot = await getDocs(collection(db, "profiles"));
  const profiles = querySnapshot.docs.map(doc => doc.data());
  const currentUser = profiles.find(p => p.name === currentUserName);

  if (!currentUser) {
    document.getElementById("noMatch").textContent = "Please create a profile first.";
    document.getElementById("noMatch").style.display = "block";
    return;
  }

  let potentialMatches = [];

  if (currentUser.type === "student") {
    if (currentUser.preference === "Mumama") {
      potentialMatches = profiles.filter(p => p.type === "outsider" && p.youAre === "Mumama");
    } else if (currentUser.preference === "Mubaba") {
      potentialMatches = profiles.filter(p => p.type === "outsider" && p.youAre === "Mubaba");
    } else if (currentUser.preference === "Student") {
      potentialMatches = profiles.filter(p => p.type === "student" && p.name !== currentUser.name);
    } else if (currentUser.preference === "Other") {
      potentialMatches = profiles.filter(p => p.type === "outsider" && p.youAre === "Other");
    }
  } else if (currentUser.type === "outsider") {
    if (currentUser.youAre === "Mumama") {
      potentialMatches = profiles.filter(p => p.type === "student" && p.preference === "Mumama");
    } else if (currentUser.youAre === "Mubaba") {
      potentialMatches = profiles.filter(p => p.type === "student" && p.preference === "Mubaba");
    } else if (currentUser.youAre === "Other") {
      potentialMatches = profiles.filter(p => p.type === "student" && p.preference === "Other");
    }
  }

  // Filter based on what they‚Äôre looking for (optional, soft filter)
  potentialMatches = potentialMatches.filter(m => m.lookingFor === currentUser.lookingFor || m.lookingFor !== "");

  displayMatch(potentialMatches[0]);
}

function displayMatch(match) {
  const container = document.getElementById("matchContainer");
  if (!match) {
    document.getElementById("noMatch").style.display = "block";
    return;
  }

  const photos = match.photos?.length ? match.photos : ["https://via.placeholder.com/400x300.png?text=No+Photo"];
  container.innerHTML = `
    <div class="match-card">
      <img src="${photos[0]}" alt="Profile Photo">
      <h2>${match.name}, ${match.age}</h2>
      <p><b>Type:</b> ${match.type}</p>
      <p><b>Looking For:</b> ${match.lookingFor}</p>
      <p><b>Hobbies:</b> ${match.hobbies || "Not specified"}</p>
      <button class="btn" onclick="startChat('${match.name}')">üí¨ Start Chat</button>
    </div>
  `;
}

window.startChat = (matchName) => {
  alert(`Chat feature coming soon! You matched with ${matchName} ‚ù§Ô∏è`);
};

findMatch();
</script>

</body>
</html>
