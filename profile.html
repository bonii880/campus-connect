<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campus Connect - Create Profile</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap');

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #ffb6c1, #ff69b4, #ffc0cb);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    /* floating hearts animation */
    .heart {
      position: absolute;
      color: rgba(255, 255, 255, 0.3);
      font-size: 24px;
      animation: float 10s infinite ease-in-out;
    }

    @keyframes float {
      0% { transform: translateY(100vh) scale(0.8); opacity: 0.6; }
      100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
    }

    .container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
      padding: 30px;
      width: 90%;
      max-width: 450px;
      text-align: center;
      z-index: 10;
    }

    h1 {
      font-family: 'Great Vibes', cursive;
      color: #ff1493;
      font-size: 42px;
      margin-bottom: 10px;
    }

    p {
      color: #444;
      margin-bottom: 25px;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ff69b4;
      border-radius: 10px;
      margin-bottom: 15px;
      font-size: 15px;
    }

    button {
      background: #ff1493;
      color: white;
      border: none;
      border-radius: 30px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 0 10px #ff69b4;
      transition: 0.3s;
    }

    button:hover {
      background: #ff69b4;
      box-shadow: 0 0 20px #ff1493;
    }

    .footer {
      margin-top: 10px;
      font-size: 13px;
      color: #555;
    }
  </style>
</head>

<body>
  <!-- floating hearts -->
  <div class="heart" style="left:10%;animation-delay:0s;">üíñ</div>
  <div class="heart" style="left:30%;animation-delay:2s;">üíò</div>
  <div class="heart" style="left:50%;animation-delay:4s;">üíï</div>
  <div class="heart" style="left:70%;animation-delay:6s;">üíû</div>
  <div class="heart" style="left:90%;animation-delay:8s;">‚ù§Ô∏è</div>

  <div class="container">
    <h1>Complete Your Profile</h1>
    <p>Let's help you find your perfect connection üíå</p>

    <select id="userType">
      <option value="student">üéì Student</option>
      <option value="outsider">üåç Outsider</option>
    </select>

    <input type="text" id="name" placeholder="Your Full Name" />
    <input type="number" id="age" placeholder="Your Age" />
    <input type="number" id="preferredAge" placeholder="Preferred Age Range" />
    <input type="text" id="university" placeholder="Your University (if student)" />
    <input type="text" id="course" placeholder="Your Course (if student)" />
    <textarea id="hobbies" rows="3" placeholder="Your Hobbies or What You Like"></textarea>
    <input type="file" id="profilePic" accept="image/*" />

    <button onclick="saveProfile()">Save My Profile üíò</button>

    <div class="footer">Campus Connect ¬© 2025</div>
  </div>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyARcZM2zSy4Xw5Q7Fn_XNX9zDh2LMAQvqw",
      authDomain: "campusconnect-44ec3.firebaseapp.com",
      projectId: "campusconnect-44ec3",
      storageBucket: "campusconnect-44ec3.appspot.com",
      messagingSenderId: "440410311105",
      appId: "1:440410311105:web:0bb84ca67f0407235d4740",
      measurementId: "G-JZ8R9VS9QC"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Only allow if logged in
    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("Please log in first!");
        window.location.href = "login.html";
      }
    });

    async function saveProfile() {
      const user = auth.currentUser;
      if (!user) return alert("You must be logged in.");

      const name = document.getElementById("name").value;
      const age = document.getElementById("age").value;
      const preferredAge = document.getElementById("preferredAge").value;
      const university = document.getElementById("university").value;
      const course = document.getElementById("course").value;
      const hobbies = document.getElementById("hobbies").value;
      const userType = document.getElementById("userType").value;
      const profilePic = document.getElementById("profilePic").files[0];

      let photoURL = "";
      if (profilePic) {
        const storageRef = ref(storage, `profiles/${user.uid}.jpg`);
        await uploadBytes(storageRef, profilePic);
        photoURL = await getDownloadURL(storageRef);
      }

      await setDoc(doc(db, "users", user.uid), {
        uid: user.uid,
        name,
        age,
        preferredAge,
        university,
        course,
        hobbies,
        userType,
        photoURL
      });

      alert("üíñ Profile saved successfully! Welcome to Campus Connect!");
      window.location.href = "home.html"; // redirect after saving
    }

    window.saveProfile = saveProfile;
  </script>
</body>
</html>
